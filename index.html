<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Huxley by jpsingleton</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Huxley</h1>
      <h2 class="project-tagline">A simple JSON proxy for the UK National Rail Live Departure Board SOAP API</h2>
      <a href="https://github.com/jpsingleton/Huxley" class="btn">View on GitHub</a>
      <a href="https://github.com/jpsingleton/Huxley/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/jpsingleton/Huxley/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="huxley" class="anchor" href="#huxley" aria-hidden="true"><span class="octicon octicon-link"></span></a>Huxley</h1>

<p><img src="https://huxley.apphb.com/huxley.png" alt="Huxley" title="Huxley"></p>

<p><img src="https://ci.appveyor.com/api/projects/status/github/jpsingleton/huxley?retina=true" alt="Build Status" title="Build Status"></p>

<h2>
<a id="uk-national-rail-live-departure-boards-json-proxy" class="anchor" href="#uk-national-rail-live-departure-boards-json-proxy" aria-hidden="true"><span class="octicon octicon-link"></span></a>UK National Rail Live Departure Boards JSON proxy</h2>

<p>Huxley is a <a href="http://enable-cors.org/">CORS</a> enabled JSON <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST</a> proxy for the UK National Rail Enquires Live Departure Board <a href="http://harmful.cat-v.org/software/xml/soap/simple">SOAP</a> <a href="http://www.nationalrail.co.uk/46391.aspx">API</a> (Darwin). </p>

<p><a href="http://harmful.cat-v.org/software/xml/soap/simple">SOAP</a> is a pain to use (you have to POST specially crafted XML) so this proxy allows you to GET nicely formatted JSON instead (<a href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST</a>). It also adds <a href="http://enable-cors.org/">CORS</a> headers so you can access it with JavaScript from a different domain.</p>

<h2>
<a id="demo" class="anchor" href="#demo" aria-hidden="true"><span class="octicon octicon-link"></span></a>Demo</h2>

<p>There is an example deployment set up <a href="https://huxley.apphb.com/">here</a>.
(<strong>DO NOT USE THIS FOR ANYTHING SERIOUS!</strong>)</p>

<p>Paste this into your web console <kbd>F12</kbd>:</p>

<div class="highlight highlight-javascript"><pre><span class="pl-k">var</span> r <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">XMLHttpRequest</span>();
r.<span class="pl-c1">open</span>(<span class="pl-s"><span class="pl-pds">"</span>GET<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>https://huxley.apphb.com/all/stp/from/bxs/1?accessToken=DA1C7740-9DA0-11E4-80E6-A920340000B1<span class="pl-pds">"</span></span>, <span class="pl-c1">true</span>);
<span class="pl-c1">r</span>.<span class="pl-en">onreadystatechange</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () {
    <span class="pl-k">if</span> (r.<span class="pl-c1">readyState</span> <span class="pl-k">!=</span> <span class="pl-c1">4</span> <span class="pl-k">||</span> r.<span class="pl-c1">status</span> <span class="pl-k">!=</span> <span class="pl-c1">200</span>) <span class="pl-k">return</span>;
    <span class="pl-k">var</span> resp <span class="pl-k">=</span> JSON.<span class="pl-c1">parse</span>(r.response);
    <span class="pl-k">if</span> (resp.trainServices <span class="pl-k">&amp;&amp;</span> resp.trainServices.<span class="pl-c1">length</span> <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>) {
        <span class="pl-c1">alert</span>(<span class="pl-s"><span class="pl-pds">"</span>The next train to arrive at <span class="pl-pds">"</span></span> <span class="pl-k">+</span> resp.locationName <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> from <span class="pl-pds">"</span></span> <span class="pl-k">+</span> resp.filterLocationName <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> will get in at <span class="pl-pds">"</span></span> <span class="pl-k">+</span> resp.trainServices[<span class="pl-c1">0</span>].sta);
    } <span class="pl-k">else</span> {
        <span class="pl-c1">alert</span>(<span class="pl-s"><span class="pl-pds">"</span>Sorry, no trains from <span class="pl-pds">"</span></span> <span class="pl-k">+</span> resp.filterLocationName <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> arriving soon<span class="pl-pds">"</span></span>);
    }
};
r.<span class="pl-c1">send</span>();</pre></div>

<p>If you want to use this proxy then you should deploy the code to your own <a href="https://appharbor.com/">App Harbor</a> or <a href="https://azure.microsoft.com/en-gb/">Azure</a> account.
If you deploy to the App Harbor Europe AWS region then this will run very close to the NRE servers.</p>

<p>SDKs in 9 languages (including Java, PHP, Python and Ruby) for this endpoint (generated with <a href="https://github.com/swagger-api/swagger-codegen">Swagger</a>) are available <a href="http://restunited.com/releases/430721415517308710/wrappers">here</a>. If you use these make sure to change the endpoint for production.</p>

<p>There is an additional Python (v2) <a href="https://github.com/Blinkinlabs/BlinkyTape_Python/blob/master/Huxley_UK_Rail_Station_Delays.py">example for a Raspberry Pi and Blinky Tape RGB LED strip</a>.</p>

<h2>
<a id="access-token" class="anchor" href="#access-token" aria-hidden="true"><span class="octicon octicon-link"></span></a>Access Token</h2>

<p>You will need to add your access token to the URL. You can register to obtain one <a href="https://realtime.nationalrail.co.uk/OpenLDBWSRegistration/Registration">here</a>.
Append the <code>accessToken={Your GUID token}</code> parameter to the query string for every request.</p>

<p>There is optional support for configuring the access token server side. So you don't need to worry about revealing it.</p>

<p>You can set <code>DarwinAccessToken</code> to your NRE access token. If you leave <code>ClientAccessToken</code> as an empty GUID then no token is required in the Huxley URL. If you set <code>ClientAccessToken</code> to a random GUID and it matches the token in the URL then the <code>DarwinAccessToken</code> will be used instead in the SOAP call. Otherwise the URL token is passed straight through. Look in the <code>Web.config</code> file for more details.</p>

<p><strong>N.B.</strong> You should set up these tokens in your deployment platform and not in your source code repository. You'll notice that the values are empty GUIDs by default. The example token used above will only work on the demo server and not directly against the SOAP API.</p>

<h3>
<a id="url-format" class="anchor" href="#url-format" aria-hidden="true"><span class="octicon octicon-link"></span></a>URL Format</h3>

<p>The URL format is <code>{board}/{CRS|StationName}/{filterType}/{filterCRS|StationName}/{numRows}</code> or <code>{board}/{CRS|StationName}/{numRows}</code> where only board and CRS (or a station name) are required. The filter type can be either <code>to</code> or <code>from</code> (case is not important).</p>

<p>A station name can be used in place of CRS codes if the name matches only one station (or matches one exactly) but case is not important. See the <a href="#crs-station-codes">CRS section</a> below for more information.</p>

<p>Examples:</p>

<ul>
<li>10 (default value) Arrivals and Departures at Clapham Junction: <code>/all/clj</code>
</li>
<li>15 Arrivals and Departures at Clapham Junction: <code>/all/clj/15</code>
</li>
<li>10 (default value) Departures at Clapham Junction to Waterloo: <code>/departures/clj/to/wat</code>
</li>
<li>15 Arrivals at Clapham Junction from Waterloo: <code>/arrivals/clj/from/wat/15</code>
</li>
<li>10 (default value) Arrivals and Departures at Wandsworth Common to Clapham Junction: <code>/all/wandsworth common/to/clapham junction</code>
</li>
<li>20 Departures at East Croydon to London Victoria: <code>/departures/east croydon/to/london victoria/20</code>
</li>
</ul>

<h3>
<a id="departures" class="anchor" href="#departures" aria-hidden="true"><span class="octicon octicon-link"></span></a>Departures</h3>

<p><a href="https://huxley.apphb.com/departures/crs?accessToken="><code>/departures/{Three letter CRS station code}?accessToken={Your GUID token}</code></a></p>

<h3>
<a id="arrivals" class="anchor" href="#arrivals" aria-hidden="true"><span class="octicon octicon-link"></span></a>Arrivals</h3>

<p><a href="https://huxley.apphb.com/arrivals/crs?accessToken="><code>/arrivals/{Three letter CRS station code}?accessToken={Your GUID token}</code></a></p>

<h3>
<a id="departures-and-arrivals" class="anchor" href="#departures-and-arrivals" aria-hidden="true"><span class="octicon octicon-link"></span></a>Departures and Arrivals</h3>

<p><a href="https://huxley.apphb.com/all/crs?accessToken="><code>/all/{Three letter CRS station code}?accessToken={Your GUID token}</code></a></p>

<h3>
<a id="service" class="anchor" href="#service" aria-hidden="true"><span class="octicon octicon-link"></span></a>Service</h3>

<p><a href="https://huxley.apphb.com/service/Z/zlpIG8jJacKayAnOXODw==?accessToken="><code>/service/{Service ID}?accessToken={Your GUID token}</code></a></p>

<p>The service ID can be found for each service inside the departures and arrivals response.</p>

<p>This endpoint also accepts the <a href="https://huxley.apphb.com/service/8c105350-4235-44f3-b076-87fe829c577e?accessToken=">GUID representation of the ID</a> as <code>/</code>, <code>+</code> and case sensitivity can cause trouble if you're not careful.
<a href="https://github.com/jpsingleton/Huxley/wiki/Train-Service-IDs">More information on the wiki</a>.</p>

<h3>
<a id="delays" class="anchor" href="#delays" aria-hidden="true"><span class="octicon octicon-link"></span></a>Delays</h3>

<p>The <strong>delays</strong> action performs calculations server side to easily let you know if there are problems on a particular route.</p>

<p><a href="https://huxley.apphb.com/delays/clapham%20junction/from/london/20?accessToken="><code>/delays/{CRS|StationName}/{filterType}/{filterCRS|StationName}/{numRows}?accessToken={Your GUID token}</code></a></p>

<p><strong>Sample Response:</strong></p>

<div class="highlight highlight-javascript"><pre>{
  <span class="pl-s"><span class="pl-pds">"</span>generatedAt<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>2015-05-08T11:28:33.7187169+01:00<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>locationName<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Clapham Junction<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>crs<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>CLJ<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>filterLocationName<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>London<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>filtercrs<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>LON<span class="pl-pds">"</span></span>,
  <span class="pl-s"><span class="pl-pds">"</span>delays<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">true</span>,
  <span class="pl-s"><span class="pl-pds">"</span>totalTrainsDelayed<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">1</span>,
  <span class="pl-s"><span class="pl-pds">"</span>totalDelayMinutes<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">16</span>,
  <span class="pl-s"><span class="pl-pds">"</span>totalTrains<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">12</span>,
  <span class="pl-s"><span class="pl-pds">"</span>delayedTrains<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
    {
      <span class="pl-s"><span class="pl-pds">"</span>origin<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
        {
          <span class="pl-s"><span class="pl-pds">"</span>locationName<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>London Waterloo<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>crs<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>WAT<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>via<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">null</span>,
          <span class="pl-s"><span class="pl-pds">"</span>futureChangeTo<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">null</span>,
          <span class="pl-s"><span class="pl-pds">"</span>assocIsCancelled<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">false</span>
        }
      ],
      <span class="pl-s"><span class="pl-pds">"</span>destination<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
        {
          <span class="pl-s"><span class="pl-pds">"</span>locationName<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>London Waterloo<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>crs<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>WAT<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>via<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">null</span>,
          <span class="pl-s"><span class="pl-pds">"</span>futureChangeTo<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">null</span>,
          <span class="pl-s"><span class="pl-pds">"</span>assocIsCancelled<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">false</span>
        }
      ],
      <span class="pl-s"><span class="pl-pds">"</span>currentOrigins<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">null</span>,
      <span class="pl-s"><span class="pl-pds">"</span>currentDestinations<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">null</span>,
      <span class="pl-s"><span class="pl-pds">"</span>sta<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">null</span>,
      <span class="pl-s"><span class="pl-pds">"</span>eta<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">null</span>,
      <span class="pl-s"><span class="pl-pds">"</span>std<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>11:20<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>etd<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>11:28<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>platform<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>3<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>operator<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>South West Trains<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>operatorCode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>SW<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>isCircularRoute<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">false</span>,
      <span class="pl-s"><span class="pl-pds">"</span>serviceID<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>F4GbTDZuLjb4VlXEYDuakg==<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>adhocAlerts<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">null</span>
    }
  ]
}</pre></div>

<p>This action will accept <code>lon</code> or <code>London</code> as a filter CRS to find trains going to or coming from any London terminal.</p>

<p>You can also pass in a comma separated list of 24 hour train times to filter on (e.g. <code>/btn/to/lon/50/0729,0744,0748</code>).</p>

<h2>
<a id="crs-station-codes" class="anchor" href="#crs-station-codes" aria-hidden="true"><span class="octicon octicon-link"></span></a>CRS Station Codes</h2>

<p>CRS (Computer Reservation System) station codes are available from the following endpoint:</p>

<p><a href="https://huxley.apphb.com/crs"><code>/crs/{query}</code></a></p>

<p>If <code>query</code> is omitted then all CRS codes are returned along with their respective station names. If <code>query</code> is provided then only station names matching it will be returned along with their CRS codes.</p>

<p>Example response for <code>/crs/oswald</code>:</p>

<div class="highlight highlight-javascript"><pre>[
  {
    <span class="pl-s"><span class="pl-pds">"</span>stationName<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Church &amp; Oswaldtwistle<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>crsCode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>CTW<span class="pl-pds">"</span></span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>stationName<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Lazonby &amp; Kirkoswald<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>crsCode<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>LZB<span class="pl-pds">"</span></span>
  }
]</pre></div>

<p><a href="https://github.com/jpsingleton/Huxley/wiki/CRS-station-codes">More information on the wiki</a>.</p>

<h2>
<a id="hosting-quick-start" class="anchor" href="#hosting-quick-start" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hosting Quick Start</h2>

<p>To get your own instance of Huxley (on <a href="https://appharbor.com/">App Harbor</a> or <a href="https://azure.microsoft.com/en-gb/">Azure</a>) follow the <a href="https://github.com/jpsingleton/Huxley/wiki/Hosting-Quick-Start">instructions on the wiki</a>.</p>

<hr>

<p>Made by <a href="https://unop.uk">James Singleton</a></p>

<p><img src="src/Huxley/NRE_Powered_logo.png" alt="powered by National Rail Enquiries" title="powered by National Rail Enquiries"></p>

<hr>

<p>Â© 2015 James Singleton</p>

<p>This program is licensed under the terms of the GNU Affero General Public License. This means that you need to share any changes (even if only running on a public server).</p>

<p>If you would like another license (such as a commercial license with an invoice) then this can be provided. Please get in touch (send an email to jpsingleton at gmail dot com). </p>

<p>Contains public sector information licensed under the Open Government Licence v3.0.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/jpsingleton/Huxley">Huxley</a> is maintained by <a href="https://github.com/jpsingleton">jpsingleton</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

